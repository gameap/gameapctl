packages:
  - name: lib32gcc
    replace-with: []

  - name: php
    pre-install:
      - conditions:
          - file-not-exists: /etc/apt/sources.list.d/ondrej-ubuntu-php-*.list
        run-commands:
        - apt-get install -y software-properties-common
        - add-apt-repository -y ppa:ondrej/php
        - apt-get update

  - name: nginx
    pre-install:
      - conditions:
          - file-not-exists: /usr/share/keyrings/nginx-archive-keyring.gpg
        run-commands:
          - mkdir -p /usr/share/keyrings/
          - curl -fsSL https://nginx.org/keys/nginx_signing.key | gpg --dearmor -o /usr/share/keyrings/nginx-archive-keyring.gpg

      - conditions:
          - file-not-exists: /etc/apt/sources.list.d/nginx.list
        run-commands:
          - echo "deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] http://nginx.org/packages/{{distname}}/ {{codename}} nginx" > /etc/apt/sources.list.d/nginx.list
          - apt-get update