packages:
  - name: lib32gcc
    replace-with: [libgcc.i686]

  - name: lib32stdc6
    replace-with: [libstdc++.i686]

  - name: lib32z1
    replace-with: [zlib.i686]

  - name: xz-utils
    replace-with: [xz]

  - name: php-extensions
    virtual: true
    replace-with: [php-bcmath, php-gd, php-gmp, php-intl,
      php-json, php-mbstring, php-mysqlnd, php-opcache,
      php-openssl, php-pdo, php-pecl-zip,
      php-readline, php-session, php-sockets, php-tokenizer,
      php-xml, php-zip]

  - name: postgresql
    replace-with: [postgresql-server, postgresql-contrib]
    post-install:
      - run-commands:
          - postgresql-setup --initdb
          - systemctl enable postgresql
          - systemctl start postgresql
      - run-commands:
          - su - postgres -c "psql -c \"ALTER USER postgres WITH PASSWORD '{{ configValue "db-root-password" }}';\""
          - su - postgres -c "psql -c \"CREATE USER {{ configValue "db-user" }} WITH PASSWORD '{{ configValue "db-password" }}';\""
          - su - postgres -c "psql -c \"CREATE DATABASE {{ configValue "db-name" }} OWNER {{ configValue "db-user" }};\""

  - name: redis-server
    replace-with: [redis]
    post-install:
      - run-commands:
          - systemctl enable redis
          - systemctl start redis